from machine import Pin, SoftI2C, PWM
import time
import _thread
import ssd1306

tor = Pin(16, Pin.PULL_DOWN)
button = Pin(19, Pin.PULL_DOWN)

i2c = SoftI2C(sda=Pin(21), scl=Pin(22))

display = ssd1306.SSD1306_I2C(128, 64, i2c)

inbuilt_led = Pin(2, Pin.OUT)

led1 = Pin(12, Pin.OUT)
led2 = Pin(13, Pin.OUT)
led3 = Pin(33, Pin.OUT)
led4 = Pin(25, Pin.OUT)
led5 = Pin(26, Pin.OUT)
led6 = Pin(27, Pin.OUT)

speaker = PWM(Pin(32))
speaker.duty_u16(0)

pixels = [(17, 1), (18, 1), (19, 1), (20, 1), (21, 1), (22, 1), (23, 1), (24, 1), (25, 1), (26, 1), (27, 1), (28, 1), (29, 1), (30, 1), (31, 1), (32, 1), (17, 2), (18, 2), (19, 2), (20, 2), (21, 2), (22, 2), (23, 2), (24, 2), (25, 2), (26, 2), (27, 2), (28, 2), (29, 2), (30, 2), (31, 2), (32, 2), (33, 2), (17, 3), (18, 3), (19, 3), (20, 3), (21, 3), (22, 3), (23, 3), (24, 3), (25, 3), (26, 3), (27, 3), (28, 3), (29, 3), (30, 3), (31, 3), (32, 3), (33, 3), (17, 4), (18, 4), (19, 4), (20, 4), (21, 4), (22, 4), (23, 4), (24, 4), (25, 4), (26, 4), (27, 4), (28, 4), (29, 4), (30, 4), (31, 4), (32, 4), (33, 4), (11, 5), (12, 5), (13, 5), (14, 5), (15, 5), (16, 5), (17, 5), (18, 5), (19, 5), (20, 5), (21, 5), (22, 5), (23, 5), (24, 5), (25, 5), (26, 5), (27, 5), (28, 5), (29, 5), (30, 5), (31, 5), (32, 5), (34, 5), (35, 5), (36, 5), (37, 5), (38, 5), (39, 5), (11, 6), (12, 6), (13, 6), (14, 6), (15, 6), (16, 6), (34, 6), (35, 6), (36, 6), (37, 6), (38, 6), (39, 6), (8, 7), (9, 7), (10, 7), (11, 7), (12, 7), (13, 7), (14, 7), (15, 7), (16, 7), (34, 7), (35, 7), (36, 7), (37, 7), (38, 7), (39, 7), (40, 7), (41, 7), (8, 8), (9, 8), (10, 8), (11, 8), (39, 8), (40, 8), (41, 8), (42, 8), (8, 9), (9, 9), (10, 9), (11, 9), (39, 9), (40, 9), (41, 9), (42, 9), (8, 10), (9, 10), (10, 10), (11, 10), (39, 10), (40, 10), (41, 10), (42, 10), (8, 11), (9, 11), (10, 11), (11, 11), (39, 11), (40, 11), (41, 11), (42, 11), (8, 12), (9, 12), (10, 12), (11, 12), (39, 12), (40, 12), (41, 12), (42, 12), (5, 13), (6, 13), (7, 13), (8, 13), (9, 13), (10, 13), (11, 13), (39, 13), (40, 13), (41, 13), (42, 13), (43, 13), (44, 13), (45, 13), (5, 14), (6, 14), (7, 14), (8, 14), (42, 14), (43, 14), (44, 14), (45, 14), (5, 15), (6, 15), (7, 15), (8, 15), (42, 15), (43, 15), (44, 15), (45, 15), (5, 16), (6, 16), (7, 16), (8, 16), (42, 16), (43, 16), (44, 16), (45, 16), (5, 17), (6, 17), (7, 17), (8, 17), (42, 17), (43, 17), (44, 17), (45, 17), (5, 18), (6, 18), (7, 18), (8, 18), (42, 18), (43, 18), (44, 18), (45, 18), (2, 19), (3, 19), (4, 19), (5, 19), (11, 19), (12, 19), (13, 19), (14, 19), (15, 19), (16, 19), (17, 19), (18, 19), (19, 19), (20, 19), (21, 19), (22, 19), (28, 19), (29, 19), (30, 19), (31, 19), (32, 19), (33, 19), (34, 19), (35, 19), (36, 19), (37, 19), (38, 19), (39, 19), (45, 19), (46, 19), (47, 19), (2, 20), (3, 20), (4, 20), (5, 20), (11, 20), (12, 20), (13, 20), (14, 20), (15, 20), (16, 20), (17, 20), (18, 20), (19, 20), (20, 20), (21, 20), (22, 20), (28, 20), (29, 20), (30, 20), (31, 20), (32, 20), (33, 20), (34, 20), (35, 20), (36, 20), (37, 20), (38, 20), (39, 20), (45, 20), (46, 20), (47, 20), (2, 21), (3, 21), (4, 21), (5, 21), (11, 21), (12, 21), (13, 21), (14, 21), (15, 21), (16, 21), (17, 21), (18, 21), (19, 21), (20, 21), (21, 21), (22, 21), (28, 21), (29, 21), (30, 21), (31, 21), (32, 21), (33, 21), (34, 21), (35, 21), (36, 21), (37, 21), (38, 21), (39, 21), (45, 21), (46, 21), (47, 21), (2, 22), (3, 22), (4, 22), (5, 22), (8, 22), (9, 22), (10, 22), (11, 22), (12, 22), (13, 22), (14, 22), (15, 22), (16, 22), (17, 22), (18, 22), (19, 22), (20, 22), (21, 22), (22, 22), (28, 22), (29, 22), (30, 22), (31, 22), (32, 22), (33, 22), (34, 22), (35, 22), (36, 22), (37, 22), (38, 22), (39, 22), (40, 22), (41, 22), (42, 22), (45, 22), (46, 22), (47, 22), (2, 23), (3, 23), (4, 23), (5, 23), (8, 23), (9, 23), (10, 23), (11, 23), (12, 23), (13, 23), (14, 23), (15, 23), (16, 23), (17, 23), (18, 23), (19, 23), (20, 23), (21, 23), (22, 23), (28, 23), (29, 23), (30, 23), (31, 23), (32, 23), (33, 23), (34, 23), (35, 23), (36, 23), (37, 23), (38, 23), (39, 23), (40, 23), (41, 23), (42, 23), (45, 23), (46, 23), (47, 23), (2, 24), (3, 24), (4, 24), (5, 24), (8, 24), (9, 24), (10, 24), (11, 24), (12, 24), (13, 24), (14, 24), (15, 24), (16, 24), (17, 24), (18, 24), (19, 24), (20, 24), (21, 24), (22, 24), (28, 24), (29, 24), (30, 24), (31, 24), (32, 24), (33, 24), (34, 24), (35, 24), (36, 24), (37, 24), (38, 24), (39, 24), (40, 24), (41, 24), (42, 24), (45, 24), (46, 24), (47, 24), (2, 25), (3, 25), (4, 25), (5, 25), (8, 25), (9, 25), (10, 25), (11, 25), (12, 25), (13, 25), (14, 25), (15, 25), (16, 25), (17, 25), (18, 25), (19, 25), (20, 25), (21, 25), (22, 25), (28, 25), (29, 25), (30, 25), (31, 25), (32, 25), (33, 25), (34, 25), (35, 25), (36, 25), (37, 25), (38, 25), (39, 25), (40, 25), (41, 25), (42, 25), (45, 25), (46, 25), (47, 25), (2, 26), (3, 26), (4, 26), (5, 26), (8, 26), (9, 26), (10, 26), (11, 26), (12, 26), (13, 26), (14, 26), (15, 26), (16, 26), (17, 26), (18, 26), (19, 26), (20, 26), (21, 26), (22, 26), (28, 26), (29, 26), (30, 26), (31, 26), (32, 26), (33, 26), (34, 26), (35, 26), (36, 26), (37, 26), (38, 26), (39, 26), (40, 26), (41, 26), (42, 26), (45, 26), (46, 26), (47, 26), (2, 27), (3, 27), (4, 27), (5, 27), (8, 27), (9, 27), (10, 27), (11, 27), (12, 27), (13, 27), (14, 27), (15, 27), (16, 27), (17, 27), (18, 27), (19, 27), (20, 27), (21, 27), (22, 27), (28, 27), (29, 27), (30, 27), (31, 27), (32, 27), (33, 27), (34, 27), (35, 27), (36, 27), (37, 27), (38, 27), (39, 27), (40, 27), (41, 27), (42, 27), (45, 27), (46, 27), (47, 27), (2, 28), (3, 28), (4, 28), (5, 28), (8, 28), (9, 28), (10, 28), (11, 28), (12, 28), (13, 28), (14, 28), (15, 28), (16, 28), (17, 28), (18, 28), (19, 28), (20, 28), (21, 28), (22, 28), (28, 28), (29, 28), (30, 28), (31, 28), (32, 28), (33, 28), (34, 28), (35, 28), (36, 28), (37, 28), (38, 28), (39, 28), (40, 28), (41, 28), (42, 28), (45, 28), (46, 28), (47, 28), (2, 29), (3, 29), (4, 29), (5, 29), (8, 29), (9, 29), (10, 29), (11, 29), (12, 29), (13, 29), (14, 29), (15, 29), (16, 29), (17, 29), (18, 29), (19, 29), (20, 29), (21, 29), (22, 29), (28, 29), (29, 29), (30, 29), (31, 29), (32, 29), (33, 29), (34, 29), (35, 29), (36, 29), (37, 29), (38, 29), (39, 29), (40, 29), (41, 29), (42, 29), (45, 29), (46, 29), (47, 29), (2, 30), (3, 30), (4, 30), (5, 30), (6, 30), (7, 30), (8, 30), (9, 30), (10, 30), (11, 30), (12, 30), (13, 30), (14, 30), (15, 30), (16, 30), (17, 30), (18, 30), (19, 30), (20, 30), (21, 30), (22, 30), (28, 30), (29, 30), (30, 30), (31, 30), (32, 30), (33, 30), (34, 30), (35, 30), (36, 30), (37, 30), (38, 30), (39, 30), (40, 30), (41, 30), (42, 30), (43, 30), (44, 30), (45, 30), (46, 30), (47, 30), (5, 31), (6, 31), (7, 31), (8, 31), (11, 31), (12, 31), (13, 31), (14, 31), (15, 31), (16, 31), (17, 31), (18, 31), (19, 31), (30, 31), (31, 31), (32, 31), (33, 31), (34, 31), (35, 31), (36, 31), (37, 31), (38, 31), (39, 31), (42, 31), (43, 31), (44, 31), (45, 31), (5, 32), (6, 32), (7, 32), (8, 32), (11, 32), (12, 32), (13, 32), (14, 32), (15, 32), (16, 32), (17, 32), (18, 32), (19, 32), (30, 32), (31, 32), (32, 32), (33, 32), (34, 32), (35, 32), (36, 32), (37, 32), (38, 32), (39, 32), (42, 32), (43, 32), (44, 32), (45, 32), (5, 33), (6, 33), (7, 33), (8, 33), (9, 33), (10, 33), (11, 33), (12, 33), (13, 33), (14, 33), (15, 33), (16, 33), (17, 33), (18, 33), (19, 33), (22, 33), (23, 33), (24, 33), (25, 33), (26, 33), (27, 33), (28, 33), (31, 33), (32, 33), (33, 33), (34, 33), (35, 33), (36, 33), (37, 33), (38, 33), (39, 33), (40, 33), (41, 33), (42, 33), (43, 33), (44, 33), (45, 33), (8, 34), (9, 34), (10, 34), (11, 34), (22, 34), (23, 34), (24, 34), (25, 34), (26, 34), (27, 34), (28, 34), (39, 34), (40, 34), (41, 34), (42, 34), (8, 35), (9, 35), (10, 35), (11, 35), (22, 35), (23, 35), (24, 35), (25, 35), (26, 35), (27, 35), (28, 35), (39, 35), (40, 35), (41, 35), (42, 35), (8, 36), (9, 36), (10, 36), (11, 36), (12, 36), (13, 36), (22, 36), (23, 36), (24, 36), (25, 36), (26, 36), (27, 36), (28, 36), (36, 36), (37, 36), (38, 36), (39, 36), (40, 36), (41, 36), (11, 37), (12, 37), (13, 37), (22, 37), (23, 37), (24, 37), (25, 37), (26, 37), (27, 37), (28, 37), (36, 37), (37, 37), (38, 37), (39, 37), (11, 38), (12, 38), (13, 38), (22, 38), (23, 38), (24, 38), (25, 38), (26, 38), (27, 38), (28, 38), (36, 38), (37, 38), (38, 38), (39, 38), (11, 39), (12, 39), (13, 39), (23, 39), (24, 39), (25, 39), (26, 39), (27, 39), (36, 39), (37, 39), (38, 39), (39, 39), (11, 40), (12, 40), (13, 40), (36, 40), (37, 40), (38, 40), (39, 40), (11, 41), (12, 41), (13, 41), (19, 41), (20, 41), (21, 41), (22, 41), (28, 41), (29, 41), (30, 41), (36, 41), (37, 41), (38, 41), (39, 41), (11, 42), (12, 42), (13, 42), (19, 42), (20, 42), (21, 42), (22, 42), (28, 42), (29, 42), (30, 42), (36, 42), (37, 42), (38, 42), (39, 42), (11, 43), (12, 43), (13, 43), (19, 43), (20, 43), (21, 43), (22, 43), (28, 43), (29, 43), (30, 43), (36, 43), (37, 43), (38, 43), (39, 43), (11, 44), (12, 44), (13, 44), (19, 44), (20, 44), (21, 44), (22, 44), (28, 44), (29, 44), (30, 44), (36, 44), (37, 44), (38, 44), (39, 44), (14, 45), (15, 45), (16, 45), (17, 45), (18, 45), (19, 45), (20, 45), (21, 45), (22, 45), (23, 45), (24, 45), (25, 45), (26, 45), (27, 45), (28, 45), (29, 45), (30, 45), (31, 45), (32, 45), (33, 45), (34, 45), (35, 45), (36, 45), (14, 46), (15, 46), (16, 46), (17, 46), (18, 46), (19, 46), (20, 46), (21, 46), (22, 46), (23, 46), (24, 46), (25, 46), (26, 46), (27, 46), (28, 46), (29, 46), (30, 46), (31, 46), (32, 46), (33, 46), (34, 46), (35, 46), (36, 46), (14, 47), (15, 47), (16, 47), (17, 47), (18, 47), (19, 47), (20, 47), (21, 47), (22, 47), (23, 47), (24, 47), (25, 47), (26, 47), (27, 47), (28, 47), (29, 47), (30, 47), (31, 47), (32, 47), (33, 47), (34, 47), (35, 47), (36, 47)]


def display_skull():
    print('starting display_skull')

    while True:
        while alarm:
            display.fill(0) # Clear the display

            for i, (x, y) in enumerate(pixels):
                display.pixel(x, y, 1)

                if i % 10 == 0:
                    display.show() # Update the display

            display.text('Warning!', 60, 30, 1)
            display.show() # Update the display
            time.sleep(5)

        display.fill(0) # Clear the display
        display.show() # Update the display


def alarmlicht():
    print("start alarmlicht")
    while True:
        while alarm:
            led1.on()
            time.sleep(0.2)
            led1.off()

            led2.on()
            time.sleep(0.2)
            led2.off()

            led3.on()
            time.sleep(0.2)
            led3.off()

            led4.on()
            time.sleep(0.2)
            led4.off()

            led5.on()
            time.sleep(0.2)
            led5.off()

            led6.on()
            time.sleep(0.2)
            led6.off()


def alarmton():
    print("start alarmton")
    while True:
        while alarm:
            speaker.duty_u16(60000)
            speaker.freq(790)
            time.sleep(0.6)

            speaker.freq(600)
            time.sleep(0.6)

        speaker.duty_u16(0)
        time.sleep(1)


alarm = False

print('start')
_thread.start_new_thread(display_skull, ())
_thread.start_new_thread(alarmlicht, ())
_thread.start_new_thread(alarmton, ())


print('starting main')
while True:
    button_value = button.value()
    print(f'button_value: {button_value}')

    tor_value = tor.value()
    print(f'tor_value: {tor_value}')

    if button_value == 0 and tor_value == 0:
        alarm = True
    else:
        alarm = False

    print(f'alarm: {alarm}')
    print()

    inbuilt_led.value(not inbuilt_led.value())
